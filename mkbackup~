#!/bin/bash
PATH=/opt/someApp/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

## backup
# en crontab -e add to run every day at 23:59
# m h  dom mon dow   command
# 59 23 * * * cd $HOME/kamaoo;./mkbackup

cd $HOME/kamaoo
echo "creating backup ...wait ..."
fecha=$(date +"%Y-%m-%d.%H:%m")

mkdir "logs/$fecha"
touch "logs/$fecha/log"

echo "...creating words.$fecha.png"
./solo_palabras "lita_chat.log"  > data-log
python crea_grafica-colored.py
tmp=$(curl -F c=@fn-worldcloud-color.png https://ptpb.pw)
echo "$tmp" >> "logs/$fecha/log"
mv fn-worldcloud-color.png "logs/$fecha/words.$fecha.png"

echo "...creating users.$fecha.png"
./solo_users "lita_chat.log"  > data-log
python crea_grafica-colored.py
tmp=$(curl -F c=@fn-worldcloud-color.png https://ptpb.pw)
echo "$tmp" >> "logs/$fecha/log"
mv fn-worldcloud-color.png "logs/$fecha/users.$fecha.png"

cp lita_chat.log "logs/$fecha/lita_chat.log"

echo "compressing folder ..."
tar -zcvf $HOME/kamaoo/logs/$fecha.tar.gz $HOME/kamaoo/logs/$fecha

echo "cleaning up ..."
rm -rf "logs/$fecha"
rm lita_chat.log
rm fn-worldcloud-color.png
rm data-log

echo "Done!";echo
cat "logs/$fecha/log"
echo
